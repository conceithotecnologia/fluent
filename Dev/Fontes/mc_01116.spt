/**
   Processamento do pedido de liberação de estoque do pedido de vendas

	@author    Gabriel Montes
	@date      09/03/2018
	@trigger   FPF B IUD

	HistÃ³rico
	---------------------------------------------------------------------------------------------------------------------
   Legenda: [-] - Correção / [*] - Recurso modificado/melhorado / [+] - Implementação de recurso

*/
Create or Replace Function mc_01116####???()
Returns trigger As 
$$
Begin
    if tg_op = 'INSERT' then
	 	new.fpf_coduser = sys_user####???();
		
		select coalesce(max(fpf_pedido + 1),1)
		  into new.fpf_pedido
		  from [(fpf)];
		
	elsif tg_op = 'UPDATE' then
		
	else
	    if old.fpf_status = 2 or
		   exists (select 1 from [(fpc)] where fpf_pedido = old.fpf_pedido)
		then
			raise '[[Compra emergêncial já utilizada em pedidos de compras.]]';
		end if;
		
		return old;
    end if;
   
   return new;
End;
$$ language plpgsql;
