/**
   Reinicialização de tarefas presas

   @author  Ricardo Gonçalves
	@date    17/10/2019   

   @param   in_service  código do serviço
   @return  número de tarefas reiniciadas

	Histórico
   ---------------------------------------------------------------------------------------------------------------------
   Legenda: [-] - Correção / [*] - Recurso modificado/melhorado / [+] - Implementação de recurso
*/
create or replace function sys_00048####???(
   in in_service integer)
returns integer as
$$
declare
   _AGUARDANDO    constant integer := 0;
   _PROCESSANDO   constant integer := 3;

   tasks          integer;
   rows           integer;
begin
   rows := 0;
      
   update [(ss084)] 
      set id = null, estado = _AGUARDANDO, processando = null, log = null, retorno = null, resultado = null
    where servico = in_service
      and estado in (_AGUARDANDO, _PROCESSANDO)
      and pulso + interval '3min' < clock_timestamp();

   get diagnostics rows = ROW_COUNT;

   return rows;
end;
$$
language plpgsql;