/**
   Triiger before da Tabela CTU

	@author    Fabio Carvalho
	@date      10/03/2016
	@trigger   CTU B

	Histórico
	---------------------------------------------------------------------------------------------------------------------
   Legenda: [-] - Correção / [*] - Recurso modificado/melhorado / [+] - Implementação de recurso
*/
Create or Replace Function mc_00925####???
() 
Returns trigger 
As $$
Declare
-- {Variáveis de uso interno}
Begin
   If tg_op <> 'DELETE' Then

      -- verifica se Ja existe a combinacao Filial, ct5_id e ctu_codigo (que pode aceitar nulo)
      if exists (select 1
                   from [(ctu)]
                  where recno <> new.recno
                    and ss063_filial = new.ss063_filial
                    and ct5_id       = new.ct5_id
                    and coalesce(ctu_codigo,'') = coalesce(new.ctu_codigo,'')) then
         raise '[[ATENÇÃO. Já existe este cadastro. Verifique!]]';
      end if;

      Return new;
   Else
      Return old;
   End If;
End;
$$ LANGUAGE plpgsql;
