/**
   Valida o preenchimento da configuração de integração Questor <-> Omie - A80

	@author    Jurandy da Silva Costa
	@date      10/02/2017 11:10:00
	@trigger   A80 B IUD

	Histórico
	---------------------------------------------------------------------------------------------------------------------
   Legenda: [-] - Correção / [*] - Recurso modificado/melhorado / [+] - Implementação de recurso

   10/02/2017 11:10:00  v1.0  Jurandy da Silva Costa
      [+] Implementação do procedimento de integração Questor <-> Omie

*/
Create or Replace Function mc_00998####???()
Returns trigger
As
$$
Declare

Begin
   If tg_op = 'INSERT' Then
      Raise '[[ATENÇÃO. Não é permitido incluir novos serviços de integração. Contate a equipe de desenvolvimento.]]';
      Return new;
   End If;   
   If tg_op = 'UPDATE' Then
      -- Valida o preencimento dos campos obrigatórios para a integração
      If (Select Count(*) From [(A81)] Where a80_codigo = new.a80_codigo) < 1 Then
         new.a80_status := 0;
      Else   
         new.a80_status := 1;
      End If;
      If new.a80_status = 1 And old.a80_status = 0 Then
         Perform sys_msg####???(1, 'ATENÇÃO. Serviço de integração Questor <-> Omie configurado e pronto para uso.');
      End If;
      If new.a80_status = 0 And old.a80_status = 1 Then
         Perform sys_msg####???(1, 'ATENÇÃO. Serviço de integração Questor <-> Omie com falha na configuração. Uso desabilitado.');
      End If;
      Return new;
   End If;   
   If tg_op = 'DELETE' Then      
      Raise '[[ATENÇÃO. Não é permitido excluir serviços de integração. Contate a equipe de desenvolvimento.]]';
      Return old;
   else
      return new;   
   End If;
End;
$$ language plpgsql;
