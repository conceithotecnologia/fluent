/**
   Marca uma posição no semáforo

	@author    Ricardo Gonçalves
	@date      03/01/2005 21:51:28
	@trigger

	@param codtable  Tabela marcada
    @param recno Registro da tabela

   @return 0 - Não marcado / 1 - Marcado

	Histórico
	---------------------------------------------------------------------------------------------------------------------
   Legenda: [-] - Correção / [*] - Recurso modificado/melhorado / [+] - Implementação de recurso

   11/01/2010 21:47:23  v1    Ricardo Gonçalves.
      [*] Alteração do nome da tabela informada para caixa alta

   19/07/2013 20:15:00  v2    Wagner Mobile Costa
      [*] Incluir a sessão na tabela para que quando a sessão for finalizada o semaforo seja finalizado também
*/
Create or Replace Function mc_setflag####???
(  In  in_codtable varchar,
   In  in_recno integer,
   Out out_result integer ) As 
$$
Declare
   csession [(ss027)].session%type;
   vtable   [(ss009)].codtable%type;
Begin
   csession := sys_session();
   vtable := upper(in_codtable);

   -- Obtem a marcação
   Select recno Into out_result
     From [(ft1)]
    Where ft1_origem = vtable
      and ft1_recno  = in_recno;

   If out_result Is Not Null Then
      out_result := 1;
      Return;
   End if;

   -- Insere a marcação
   Insert Into [(ft1)] ( ft1_origem, ft1_recno, session)
        Values         ( vtable,     in_recno,  csession);

   out_result := 1;
End;
$$ language plpgsql;