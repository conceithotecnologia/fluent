/**
   Revoga permissão para objeto informado

	@author    Ricardo Gonçalves
	@date      22/06/2009 19:30:45
	@trigger

   @param   in_obj   Objeto do sistema Fluent. Código hexadecimal de nove caracteres
   @param   in_perm  Permissão que deve ser revogada para o objeto informado. O formato desse parâmetro
                     deve ser in_obj + permissao, por exemplo, '00001aaf.u'. É possível informar, também,
                     o caractere coringa '*'; quando utilizado remove todas as permissões associadas ao
                     objeto informado.

   @return  quantidade de permissões revogadas para o objeto informado.

	Histórico
	---------------------------------------------------------------------------------------------------------------------
*/
Create or Replace Function sys_revoke_obj(
   in_obj varchar,
   in_perm varchar)
Returns integer
AS
$$
Declare
   vperm_id    [(ss095)].perm_id%type;
   vperm       [(ss095)].perm_id%type;
   iresult     integer;
Begin
   vperm_id := lower(in_obj);
   vperm := lower(in_perm);

   if vperm_id is null then
      raise '[[Não é possível revogar permissões de objetos nulos. Verifique.]]';
   end if;

   if vperm is null then
      raise '[[Não é possível revogar permissões nulas. Verifique.]]';
   end if;

   if trim(in_perm) = '*' then
      delete
        from ss095
       where obj_id = vperm_id;
   else
      -- Valida o tipo de permissão
      perform sys_ck_perm_type(vperm);

      vperm := vperm_id || '.' || vperm;

      delete
        from ss095
       where perm_id = vperm;
   end if;

   GET DIAGNOSTICS iresult = ROW_COUNT;

   Return iresult;
End;
$$
language plpgsql;
