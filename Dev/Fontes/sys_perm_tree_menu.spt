/**
   Processa permissões para um determinado item de menu

	@author    Ricardo Gonçalves
	@date      24/04/2010 17:17:46
	@trigger

	@param  in_sis   código do sistema
	@param  in_role  papel
	@param  in_menu  código do menu cujos filhos devem ser processados
	@param  in_grant Assume os valores True - Grant das permissões / False - Revoke das permissões

	Histórico
	---------------------------------------------------------------------------------------------------------------------
   Legenda: [-] - Correção / [*] - Recurso modificado/melhorado / [+] - Implementação de recurso
*/
CREATE OR REPLACE FUNCTION sys_perm_tree_menu####???(
   in_sys integer,
   in_role integer,
   in_menu integer,
   in_grant boolean)
RETURNS integer
AS
$$
BEGIN
   -- Processa as dependências de objetos do menu
   perform sys_perm_tree####???(in_sys, in_role, s17.obj_id, in_grant)
      from ss017 s17
     where s17.codsis = in_sys
       and s17.obj_id is not null
       and s17.codpai = in_menu;

   -- Processa os subitens de menu
   perform sys_perm_tree_menu####???(in_sys, in_role, s17.codmenu, in_grant)
      from ss017 s17
     where s17.codsis = in_sys
       and s17.codpai = in_menu
       and s17.obj_id is null;

   return 1;
END;
$$
  LANGUAGE 'plpgsql' VOLATILE;