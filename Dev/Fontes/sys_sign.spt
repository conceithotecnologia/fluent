/*============================================================================
  Empresa..: MultCont Informática
  Descrição: Esta rotina é reponsável por gerenciar o arquivo de cabeçalho da 
             assinatura digital. O primeiro parâmetro deve ser gerado de forma 
             que seu conteúdo seja único dentro da empresa. Através da 
             assinatura que rotina sabe como proceder em relação a 
             agrupamentos e outros por menores.
  Autor....: Ricardo Gonçalves
  Data.....: 20/02/2006 11:22:16

  Parametro       Descrição
  ---------------------------------------------------------------------------
  in_signature   | Assinatura gerada pela rotina de origem
  in_colaborador | Colaborador que autenticará a assinatura
  in_codtable    | Tabela que gerou a assinatura
  in_recno       | Recno da tabela que gerou a assinatura
  in_tg_op       | Operação - vide parâmetro TG_OP;
  out_recno      | Recno da assinatura criada/localizada
  ============================================================================*/
Create or Replace Function sys_sign####???
(  in in_signature      varchar,
   in in_colaborador    varchar(16),
   in in_codtable       varchar(20),
   in in_recno          integer,
   in in_tg_op          varchar,
  out out_recno         integer )
AS
$$
Begin
   out_recno:= 0;

   if in_tg_op = 'DELETE' then
      Delete
        From [(szs)]
       where szs_signature = in_signature;

      Return;
   end if;

   -- Verifica se a assinatura existe
   select recno
     into out_recno
     from [(szs)]
    where szs_signature = in_signature;

   if out_recno is not null then
      Return;
   end if;

   -- Cria assinatura
   insert into [(szs)] (szs_signature, sd4_apelido,    codtable,    szs_recno, szs_titulo,
                        szs_assinatura )
        values         (in_signature,  in_colaborador, in_codtable, in_recno,  'Assinatura',
                        'Assinatura gerada');

   -- Recupera o recno da assinatura rescem criada
   select recno
     into out_recno
     from [(szs)]
    where szs_signature = in_signature;
End;
$$
language plpgsql;