/**
   Configuração inicial da tela de liberação de estoque

	@author    Ricardo Gonçalves
	@date      14/02/2018
	@trigger   

	Histórico
	---------------------------------------------------------------------------------------------------------------------
   Legenda: [-] - Correção / [*] - Recurso modificado/melhorado / [+] - Implementação de recurso
*/
Create or Replace Function scr_00213####???
(  out out_res integer )
As $$
Declare
   iFichaEsto   [(a5w)].a4i_tipo%type;      -- Ficha de estoque
   cb1_Codpro   [(sag)].b1_codpro%type;     -- Código do Produto
   irecno       [(sag)].recno%type;
   cSessao      [(ss029)].session%type;       -- Nome da sessao   
   
Begin
   cSessao := sys_session();
   
   irecno := sys_042integer2####???('SAG', 'recno');
   
   -- Recuperando informações do item de pedido
   select b1_codpro
     into cb1_Codpro
     from [(sag)]
    where recno = irecno;

   -- Verifica se a ficha de estoque foi preenchida
   If sys_042integer####???('a4i_tipo') Is Null Then
      -- Recupera o código da ficha de estoque do cadastro do produto
      Select a4i_tipo_s Into iFichaEsto
        From [(sbf)] 
       Where b1_codpro = cb1_Codpro;
      -- Atualiza o código da ficha de estoque com a encontrada no produto
      perform sys_042integer_wr####???('a5w', 'a4i_tipo', iFichaEsto);
   End If;   
   
   -- Se produto controla lote habilita campo lote   
   if mc_00049####???(cb1_Codpro) = 0 then
      perform sys_042integer_wr####???('a5w', 'sd3_lote', null);
      perform sys_042enabled_wr####???('a5w', 'sd3_lote', 0);
   else
      perform sys_042enabled_wr####???('a5w', 'sd3_lote', 1);
   end if;
     
   out_res := 1;
End;
$$ language plpgsql;