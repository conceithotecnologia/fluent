/**
   Rotina de Tratamento dos Itens Marcados Para Emissao da Nota de Debito e lote de fechamento do calculo

	@author    Fabio Carvalho
	@date      29/08/2009 08:30
	@trigger

	@param in_iRecno Número do recno selecionado pelo usuário na tabela LOR
   @param in_iSelecao 0-Removida a Seleção, 1-Registro Selecionado ou -1=Finalização do formulário

   @return 1 - Sucesso / 0 - Falha

	Histórico
	---------------------------------------------------------------------------------------------------------------------
   Legenda: [-] - Correção / [*] - Recurso modificado/melhorado / [+] - Implementação de recurso

   30/01/2015 10:00:00  v1   Wagner Mobile Costa
      [*] Tratamento para marcação de registros sempre baseado em recno ou na ação de finalização do formulário
*/
Create or Replace Function mc_00201####???
( In  in_irecno   Integer,
      in_iselecao Integer,
  Out out_res     Integer )
As $$
Declare
-- {Variáveis para cursores}
-- {Variáveis de uso interno}
   cSessao  Varchar(35);
Begin
   cSessao := sys_session();

   -- verifica se lote esta fechado
   if in_iselecao = 1 then
      if (select lor_status
            from [(lor)]
            where recno = in_irecno) <> 2 then
         raise '[[Seleção permitida somente com lotes encerrados. Verifique!]]';
      end if;
   end if;

   Out_res := 1;
End;
$$ language 'plpgsql';