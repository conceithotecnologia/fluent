/*==================================================================================================================================
  Rotina...: <l> sys_primarykey </l>
  --------------------------------------------------------------------------------------------------------------------------------
  Descriусo: <d> Retorna os campos da chave primрria do catalogo do banco de dados </d>
  --------------------------------------------------------------------------------------------------------------------------------
  Tipo.....: <t> Stored Procedure </t>
  --------------------------------------------------------------------------------------------------------------------------------
  Empresa..: MultCont Informрtica
  --------------------------------------------------------------------------------------------------------------------------------
  Autor....: Wagner Mobile Costa
  --------------------------------------------------------------------------------------------------------------------------------
  Data.....: 11/06/2007 00:00:00                   Alterado.:
  --------------------------------------------------------------------------------------------------------------------------------
  Parametros
   [Entrada]ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии
   [Saida ]иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии
==================================================================================================================================*/
Create or Replace Function sys_primarykey
(  in in_table name,
   in in_type "char",
   in in_conkey smallint[],
   out outres varchar(255) )
AS $$
Declare
   iFields integer; 
Begin
   -- Retorna Somente Chave Primрria
   if coalesce(in_type, '') <> 'p' then
      outres:= null;
      return;
   end if;

   iFields:= 1;
   outres:= '';
   while iFields <= array_upper(in_conkey, 1) loop
      If iFields > 1 then
         outres:= outres || ',';
      end if;

      outres:= outres || (select b.attname from pg_class a 
                            JOIN pg_attribute b ON b.attrelid = a.oid 
                           where a.relname = in_table and attnum = in_conkey[iFields]);
      ifields:= ifields + 1;
   end loop;
End;
$$ LANGUAGE plpgsql;