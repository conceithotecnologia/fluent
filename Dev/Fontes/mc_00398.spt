/**
   Trigger da Tabela LC1 - Itens da Locação Caçamba

	@author    Fabio Carvalho
	@date      14/02/2012
   @trigger   LC1 A IUD

	Histórico
	---------------------------------------------------------------------------------------------------------------------
   Legenda: [-] - Correção / [*] - Recurso modificado/melhorado / [+] - Implementação de recurso

   12/03/2011 18:26:18  v2 Ricardo Gonçalves.
      [+] Atualização do campo que contém a lagura da conta do nível

*/
Create or Replace Function mc_00398####???()
Returns trigger
As $$
Declare
-- {Variáveis de uso interno}
   iTalao  [(lc0)].lc0_num_talao%type;
   nTotal  [(lc0)].lc0_total%type;


Begin
   if tg_op = 'DELETE' then
      iTalao := old.lc0_num_talao;
   else
      iTalao := new.lc0_num_talao;
   end if;


   -- Seleciona o Valor Total da Locação
   select coalesce(sum(lc1_total),0)
     into nTotal
     from [(lc1)]
    where lc0_num_talao = iTalao;


   -- Altera o Valor Total
   update [(lc0)] 
      set lc0_total = nTotal
    where lc0_num_talao = iTalao;

   if tg_op = 'DELETE' then
      return old;
   else
      return new;
   end if;

End;
$$ language plpgsql;