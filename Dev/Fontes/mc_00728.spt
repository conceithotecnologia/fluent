/*==================================================================================================================================
  Rotina...: <l> mc_00728 </l>
  --------------------------------------------------------------------------------------------------------------------------------
  Descrição: <d> Valida o detalhamento por natureza dos Pagamentos com Cartão de Crédito - FCO </d>
  --------------------------------------------------------------------------------------------------------------------------------
  Tipo.....: <t> Trigger - BEFORE - FCO </t>
  --------------------------------------------------------------------------------------------------------------------------------
  Empresa..: MultCont Informática
  --------------------------------------------------------------------------------------------------------------------------------
  Autor....: Jurandy da Silva Costa
  --------------------------------------------------------------------------------------------------------------------------------
  Data.....: 03/07/2008 21:03:00                    Alterado.: 03/07/2008
  --------------------------------------------------------------------------------------------------------------------------------
==================================================================================================================================*/
Create or Replace Function mc_00728####???() Returns trigger As $$
Declare
-- {Variáveis de uso interno}

   cOrigem1       [(fco)].fcj_origem%type;        -- Prefixo da tabela de origem
   iRecno01       [(fco)].fcj_recno%type;         -- Registro na tabela de origem

Begin
   If tg_op = 'DELETE' Then
      cOrigem1 := old.fcj_origem;
      iRecno01 := old.fcj_recno;
   Else
      If tg_op = 'UPDATE' Then
         If new.f1_codnat  = old.f1_codnat  And new.fco_valor  = old.fco_valor And
            old.fco_rateio = new.fco_rateio And old.fco_ccusto = new.fco_ccusto Then
            Return new;
         End If;
      End If;
      cOrigem1 := new.fcj_origem;
      iRecno01 := new.fcj_recno;
   End If;

   -- Lançamentos originarios do pagamento com outro Cartão de Crédito não podem ser editados diretamente
   If mc_getflag####???( cOrigem1, iRecno01 ) = 0 Then
      If cOrigem1 Is Null Then
         raise '[[Não é possível incluir detalhamento sem o documento principal.]]';
      Else
         raise '[[Detalhamento automático do pagamento com outro Cartão de Crédito. Não pode ser alterado.]]';
      End If;
   End If;
   If tg_op <> 'DELETE' Then
      Return new;
   Else
      Return old;
   End If;
End;
$$ language plpgsql;