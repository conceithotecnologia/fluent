/*==================================================================================================================================
| Empresa..: MultCont Informática                                                                                                  |
| -------------------------------------------------------------------------------------------------------------------------------- |
| Autor....: Jurandy da Silva Costa                                                                                                |
| -------------------------------------------------------------------------------------------------------------------------------- |
| Data.....: 17/03/2008 19:30:00                                                                                                   |
| -------------------------------------------------------------------------------------------------------------------------------- |
| Tipo.....: Stored Procedure                                                                                                      |
| -------------------------------------------------------------------------------------------------------------------------------- |
| Descrição: Busca endereços de Faturamento, Entrega ou Cobrança no cadastro do cliente                                            |
| -------------------------------------------------------------------------------------------------------------------------------- |
====================================================================================================================================
| Parametros                                                                                                                       |
|  [Entrada]······················································································································ |
             iCodigoCli: Código do cliente a buscar o endereço
             iTipoEnde1: Tipo de endereço a buscar 0-Unico, 1-Faturamento, 2-Entrega, 3-Cobrança
             iTipoEnde2: Tipo de endereço a buscar 0-Unico, 1-Faturamento, 2-Entrega, 3-Cobrança
             iContaEnde: Buscar ou Contar ? 0-Buscar, 1-Contar
             nQuantos:   Quantidade do item
             iEndereço:  Retorna o código do endereço ou a quantidade encontrada
==================================================================================================================================*/
Create or Replace Function scr_00010_se2####???
( In  iCodigoCli Integer,
  In  iTipoEnde1 Integer,
  In  iTipoEnde2 Integer,
  In  iContaEnde Integer,
  Out iEndereco  Integer )
As $$

Declare

Begin
   iEndereco := 0;
   -- Se iContaEnde > 0 apenas conta caso contrário busca
   If iContaEnde > 0 Then
      Select Count(*) Into iEndereco
        From [(se2)]
       Where a1_codcli = iCodigoCli
         And se2_vigencia = (Select Max(se2_vigencia)
                               From [(se2)]
                              Where a1_codcli = iCodigoCli
                                And se2_vigencia <= current_date
                                And se2_tipo In (iTipoEnde1, iTipoEnde2))
         And se2_tipo In (iTipoEnde1, iTipoEnde2);
   Else
      Select se2_ctrl Into iEndereco
        From [(se2)]
       Where a1_codcli = iCodigoCli
         And se2_vigencia = (Select Max(se2_vigencia)
                               From [(se2)]
                              Where a1_codcli = iCodigoCli
                                And se2_vigencia <= current_date
                                And se2_tipo In (iTipoEnde1, iTipoEnde2))
         And se2_tipo In (iTipoEnde1, iTipoEnde2);
   End If;

End;
$$ language 'plpgsql'
