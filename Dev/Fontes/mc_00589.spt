/*==================================================================================================================================
  Rotina...: <l> mc_00589 </l>
  --------------------------------------------------------------------------------------------------------------------------------
  Descrição: <d> Atualiza o saldo mensal Realizado por natureza financeira em SFC </d>
  --------------------------------------------------------------------------------------------------------------------------------
  Tipo.....: <t> Stored Procedure </t>
  --------------------------------------------------------------------------------------------------------------------------------
  Empresa..: MultCont Informática
  --------------------------------------------------------------------------------------------------------------------------------
  Autor....: Jurandy da Silva Costa
  --------------------------------------------------------------------------------------------------------------------------------
  Data.....: 14/01/2005 18:30:00                                       Alterado.: 02/10/2010
  --------------------------------------------------------------------------------------------------------------------------------
==================================================================================================================================*/
Create or Replace Function mc_00589####???() Returns trigger As $$
Begin
   If sys_tglocked####???('MC_00533') = 0 Then
      -- Se Exclusão ou Alteração subtrai do acumulado o valor anterior
      If tg_op <> 'INSERT' Then
         Perform mc_00586####???( old.f1_codnat,  old.fc8_data, 0, (old.fc9_valor * -1), old.fak_filial, 'FC9', old.fc8_tipo, 0 );
      End If;
      -- Se não for Exclusão soma no acumulado o valor atual
      If tg_op <> 'DELETE' Then
         Perform mc_00586####???( new.f1_codnat,  new.fc8_data, 0, new.fc9_valor, new.fak_filial, 'FC9', new.fc8_tipo, 0 );
      End If;
   End If;
   If tg_op <> 'DELETE' Then
      Return new;
   Else
      Return old;
   End If;
End;
$$ language plpgsql;

