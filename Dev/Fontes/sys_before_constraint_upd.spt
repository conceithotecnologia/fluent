/**
   Instruções executadas antes da criação das constraints

	@author    Wagner / Ricardo
	@date      07/10/2006 16:39:47
	@trigger

	Histórico
	---------------------------------------------------------------------------------------------------------------------
   Legenda: [-] - Correção / [*] - Recurso modificado/melhorado / [+] - Implementação de recurso

   18/09/2012 16:48:15  v1    Ricardo Gonçalves.
      [-] Atribuindo valor de retorno a variável

   07/04/2013 06:00:00  v2    Wagner Mobile Costa.
      [-] Retirada de instruções desnecessárias e remoção de registros de objetos favoritos inexistentes
*/
Create or Replace Function sys_before_constraint_upd####???
( In  in_version varchar(30),
  In  in_executa integer,
  out out_res Integer)
As $$
begin
   -- Remoção de Registros invalidos na segurança
   delete
     from [(ss098)]
    where perm_id in (
      select s98.perm_id
        from [(ss098)] s98
       where not exists (
             select 1
               from [(ss095)] s95
              where s95.perm_id = s98.perm_id));


   -- Remove favoritos que não existem mais
   delete from [(ss074)] where obj_id not in (select obj_id from [(ss018)]);

   out_res := 1;
End;
$$ language 'plpgsql';
