/**
   Definição do layout CNAB utilizado pelo banco selecionado

	@author    Jurandy da Silva Costa
	@date      20/01/2011 21:15:00
	@trigger

        @return iTamanho -> 0 = CNAB 240 - 1 = CNAB 400 

	Histórico
	---------------------------------------------------------------------------------------------------------------------
   Legenda: [-] - Correção / [*] - Recurso modificado/melhorado / [+] - Implementação de recurso

   24/01/2011 21:15:00  v1.0  Jurandy da Silva Costa.
      [*] Sem histórico.

*/
Create or Replace Function mc_00755####???( Out iTamanho Integer )
As $$
Declare

-- {Variáveis de uso interno}
   iRemessa       [(fbs)].fbs_remessa%type;       -- Número da remessa
   cContaBco      [(fr3)].ak_cc%type;             -- Número da conta
   cSessao        [(fr3)].session%type;           -- Sessão atual do usuário
   iFebraban      [(sa9)].r_febraban%type;        -- Indicador do layout Febraban
   iCodBanco      [(sak)].a9_codbanco%type;       -- Código do banco a gerar remessa

Begin
   -- Recupera o número da conta que está sendo processada na sessão atual
   Select Max(ak_cc) Into cContaBco
     From [(fr3)]
    Where session = sys_session();

   -- Recupera o último número de remessa do usuário atual
   Select Max(fbs_remessa) Into iRemessa
     From [(fbs)]
    Where ak_cc = cContaBco
      And fbs_user_g = sys_user####???();

   -- Recupera o código do banco no cadastro da conta bancária
   Select a9_codbanco Into iCodBanco
     From [(sak)]
    Where ak_cc = cContaBco;

   -- Recupera o indicador de padrão FEBRABAN no banco
   Select r_febraban Into iFebraban
     From [(sa9)]
    Where a9_codbanco = iCodBanco;

   If iFebraban = 1 Then
      iTamanho := 0;                -- Layout FEBRABAN - Mesmo para todos os bancos
   Else
      If iCodBanco = 001 Then       -- Banco 001 - Banco do Brasil
         iTamanho := 1;
	  ElsIf iCodBanco = 104 Then    -- Banco 104 - Banco Caixa Econômica Federal
         iTamanho := 1;
      ElsIf iCodBanco = 151 Then    -- Banco 151 - Banco Nossa Caixa
         iTamanho := 1;
      ElsIf iCodBanco = 237 Then    -- Banco 237 - Banco Bradesco
         iTamanho := 1;
      ElsIf iCodBanco = 341 Then    -- Banco 341 - Banco Itaú
         iTamanho := 1;
      ElsIf iCodBanco = 008 Or iCodBanco = 033 Then    -- Banco 033 - Banco Santander
         iTamanho := 0;
      ElsIf iCodBanco = 353 Or iCodBanco = 356 Then    -- Banco 356 - Banco Real
         iTamanho := 0;
      ElsIf iCodBanco = 399 Then    -- Banco 399 - Banco HSBC
         iTamanho := 1;
      ElsIf iCodBanco = 409 Then    -- Banco 409 - Banco Unibanco
         iTamanho := 1;
      End If;
   End If;

End;
$$ language 'plpgsql';
