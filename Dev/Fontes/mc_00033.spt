/**
   Valida manutenção do itens na classificações de materiais de entrada SCG

	@author    Ricardo Gonçalves
	@date      27/10/2006 16:13:32
	@trigger   SCG B IUD

	Histórico
	---------------------------------------------------------------------------------------------------------------------
   Legenda: [-] - Correção / [*] - Recurso modificado/melhorado / [+] - Implementação de recurso
   
   29/09/2009 17:50:06  v1.1  Ricardo Gonçalves.
      [*] Alteração do cabeçalho
*/
Create or Replace Function mc_00033####???() 
Returns trigger As 
$$
Begin
   if tg_op <> 'INSERT' then
      if old.scg_src = 2 then
         raise '[[Esse item não pode sofrer alterações pois foi classificado automaticamente pelo sistema.]]';
      end if;
   end if;

   if tg_op <> 'DELETE' then
      if new.scg_src = 1 and new.scg_loteforn is null then
         raise '[[Referência é obrigatória.]]';
      end if;
   end if;

   -- Preenche o local de armazenamento e o endereço padrão
   if tg_op = 'INSERT' then      
      new.scg_data:= localtimestamp;
   end if;

   if tg_op = 'DELETE' then
      return old;
   else
      return new;
   end if;
End;
$$ language plpgsql;