/**
   Verifica se o produto tem natureza financeira definida e retorna

	@author    Jurandy da Silva Costa
	@date      11/11/2006 21:00:00
	@trigger

	@param cProduto  Código do produto
	@param iNatAntes Natureza financeira anterior

	@return natureza localizada

	Histórico
	---------------------------------------------------------------------------------------------------------------------
   Legenda: [-] - Correção / [*] - Recurso modificado/melhorado / [+] - Implementação de recurso

   20/07/2010 21:19:55  v2    Ricardo Gonçalves.
      [*] Alteração do cabeçalho e declaração da função.

   05/10/2012 14:51:18  v3    Ricardo Gonçalves.
      [*] Alteração do teste que verifica se a natureza está ativa.
*/
Create or Replace Function mc_valnatureza####???
( In  cProduto    VarChar(25),  In  iNatAntes   Integer) Returns Integer As $$
Declare
   vb1_nome    [(sb1)].b1_nome%type;
   iNatureza   [(sf1)].f1_codnat%type;

Begin
   select coalesce(sbf.f1_codnat, sb1.f1_codnat), sb1.b1_nome
     into iNatureza, vb1_nome
     From [(sb1)] sb1
          left join [(sbf)] sbf
            on sbf.b1_codpro = sb1.b1_codpro
    Where sb1.b1_codpro = cproduto;

   -- Se não encontrou a classificação retorna mensagem de erro
   If iNatureza is null Then
       raise '[[ATENÇÃO. O produto % - % não tem natureza financeira. Classifique-o e tente novamente.]]', cProduto, vb1_nome;
   End If;
   -- Verifica se a natureza financeira incluída ou alterada está ativa
   If iNatAntes Is Null Or iNatAntes <> iNatureza Then
      If not ck_00007####???(iNatureza) Then
         raise '[[ATENÇÃO. A natureza financeira % utilizada neste produto está inativa. Favor verificar.]]', iNatureza;
      End If;
   End If;

   Return iNatureza;
End;
$$ language plpgsql;