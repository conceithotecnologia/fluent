/*============================================================================
  Empresa..: MultCont Informática
  Descrição: Prepara campos do documento de separação
  Autor....: Ricardo Gonçalves
  Data.....: 08/10/2007 21:01:49
  Parametro:      Descrição
  ---------------------------------------------------------------------------
  out_res        | 0 - Falha / 1 - Sucesso
  ============================================================================*/
Create or Replace Function mc_00075####???() 
Returns trigger 
As $$
Declare
   iLocaliz          [(sbf)].sbf_localiz%type;
   irastro           [(sbf)].sbf_rastro%type;
Begin
   -- Recupera informação de localização física
   ilocaliz:= mc_00061####???(new.b1_codpro);
   irastro:= mc_00049####???(new.b1_codpro);

   -- Caso o produto não utilize controle de endereçamento, preenche com branco e retorna
   if irastro = 0 then
      new.sd3_lote:= -1;
   end if;

   if tg_op = 'INSERT' then
      if new.sd3_lote is null then
         raise '[[Produto % possuí controle de rastreabilidade. Favor informar um lote válido]]', new.b1_codpro;
      end if;

      -- Caso o usuário não tenha informado um endereço apresenta erro
      if new.b3_endereco is null then
         raise '[[Produto % possuí controle de endereçamento. Favor informar um endereço válido]]', new.b1_codpro;
      end if;
   end if;

   return new;
End;
$$ language plpgsql;