/**
   Lançamento Despesa Cartao Credito x Fatura Jfr

	@author    Fabio Carvalho
	@date      03/03/2020
	@trigger   FCU B

	Histórico
	---------------------------------------------------------------------------------------------------------------------
   Legenda: [-] - Correção / [*] - Recurso modificado/melhorado / [+] - Implementação de recurso
*/
Create or Replace Function mc_01291####???()
Returns trigger
As $$
Declare
Begin
   if tg_op <> 'DELETE' then

      --Retornar Status
      if tg_op = 'UPDATE'   and
         old.fcu_status = 1 and
         new.fcu_status = 0 then
         raise '[[ATENÇÃO. Opção Inválida. Verifique!]]';
      end if;

      --Fatura
      if exists (select 1
                   from [(tlw)]
                  where recno = new.recno
                    and tlw_estado > 1) then
         raise '[[ATENÇÃO. A Fatura de serviços %, não está com status <EM ABERTO>. Verifique!]]', new.tlw_recno;
      end if;

      return new;
   else
      return old;
   end if;
End;
$$ language plpgsql;