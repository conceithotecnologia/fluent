/**
   Checa se o usuário tem acesso a um determinado recurso

	@author    Ricardo Gonçalves
	@date      08/12/2016 19:34:00
	@trigger

   @param   in_perm_id  Permissão a ser checada

   @return  Levanta uma exceção se o usuário não tiver acesso ao recurso

	Histórico
	---------------------------------------------------------------------------------------------------------------------	
*/
Create or Replace Function sys_access_error####???(
   in in_perm_id varchar(25))
Returns void
As
$$
Declare
   vperm_name  [(ss095)].perm_name%type;
   r           record;
Begin
   if sys_access####???(in_perm_id) != 1 then      
      -- Recupera a descrição da transação
      select perm_name 
        into vperm_name 
        from [(ss095)]
       where perm_id = in_perm_id;
      
      if not Found then
         raise '[[Permissão % não localizada.]]', in_perm_id;
      end if;
      
      select coduser, name
        into r
        from [(ss003)]
       where coduser = sys_user####???();
       
      raise '[[O usuário "% - %" não tem acesso a transação "%"]]', r.coduser, r.name, vperm_name;
   end if;
End;
$$
language plpgsql;