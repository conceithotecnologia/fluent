/**
   Verifica se a pessoa física está inativa

	@author    Gabriel Montes
	@date      17/05/2013 09:06:00
	@trigger   

   -- Verifica se a pessoa física tem cadastro de colaborador
   -- Verifica se a pessoa física está ativa
   -- Verifica se o login está ativo
   
   
   @return integer código do colaborador quando o login é válido
   
	Histórico 
	---------------------------------------------------------------------------------------------------------------------
   Legenda: [-] - Correção / [*] - Recurso modificado/melhorado / [+] - Implementação de recurso
*/ 
CREATE OR REPLACE FUNCTION ck_00009####???(
   in in_colaborador varchar(16)) 
RETURNS integer AS 
$$
Declare  
   r record;
BEGIN 
   select sfj.sfj_pessoa, sfj.sfj_nome, sfj.sfj_situacao,
          s03.active 
     into r
     from [(a2k)] a2k  
          join [(sfj)] sfj
            on sfj.sfj_pessoa = a2k.sfj_pessoa
          join [(ss003)] s03 
            on s03.coduser = a2k.coduser
    where a2k.coduser = in_colaborador;

   if not Found then
      raise '[[Login "%" não está associado a perfil de colaborador.]]', in_colaborador;
   end if;
   
   -- Verificando se a pessoa física está ativa
   if r.sfj_situacao != 1 then
      raise '[[O cadastro da pessoa física "% - %" associado ao login "%" está inativo.]]', 
         r.sfj_pessoa, r.sfj_nome, in_colaborador;
   end if;
         
   -- Verificando se o login está ativo
   if r.active != 1 then
      raise '[[O login "%" associado ao colaborador "% - %" está inativo.]]', 
         in_colaborador, r.sfj_pessoa, r.sfj_nome;
   end if;       
   
   return r.sfj_pessoa;
END;
$$
  LANGUAGE 'plpgsql' VOLATILE;