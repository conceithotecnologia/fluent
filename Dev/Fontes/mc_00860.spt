/*
   F04 - Valida informações do Cadastro de Dependentes

   Autor	   Bárbara de Paula
   Data     12/03/2015 15:05:00 
   Trigger  F04 - Before D

	Histórico
	------------------------------------------------------------------
   Legenda: [-] - Correção / [*] - Recurso modificado/melhorado / [+] - Implementação de recurso
*/

create or replace function mc_00860####???()
returns trigger
As $$
DECLARE
   vMes varchar;
   vCadastro varchar;
BEGIN
	if tg_op = 'DELETE' THEN
  
		vMes      := (extract (month from current_date) ||'/'|| extract (year from current_date) );
		vCadastro := (extract (month from old.d_i)      ||'/'|| extract (year from old.d_i) );
	
		if vMes <> vCadastro then 
			raise '[[Exclusões só são permitidas no mês de inclusão do dependente na base]]';
		end if;
	 
		return old;
	else 
		perform sys_cpf(new.f04_cpf);
    end if;    
	
    return new;
end;
$$ language plpgsql;