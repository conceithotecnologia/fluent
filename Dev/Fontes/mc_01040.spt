/**
   Processa o cadastro de recursos

	@author    Ricardo Gonçalves
	@date      13/9/2017
	@trigger   SD4 B IUD

	HistÃ³rico
	---------------------------------------------------------------------------------------------------------------------
   Legenda: [-] - Correção / [*] - Recurso modificado/melhorado / [+] - Implementação de recurso
*/
Create or Replace Function mc_01040####???() 
Returns trigger AS 
$$
Declare
   r  record;
Begin   
   if tg_op = 'DELETE' then      
      return old;
   end if;
   
   
   --Validando o endereço
   if new.b3_endereco is not null then
      select b3_nome, b3_bloq, b3_prod
        into r
        from [(sb3)]
       where b3_endereco = new.b3_endereco;
      
      if r.b3_prod = 0 then
         raise '[[O endereço "% - %" não pode usado na produção!]]', new.b3_endereco, r.b3_nome;
      end if;
      
      if r.b3_bloq = 3 then
         raise '[[O endereço "% - %" está bloqueado!]]', new.b3_endereco, r.b3_nome;
      end if;
   end if;
   
   return new;
End;
$$  LANGUAGE plpgsql;
