/*==================================================================================================================================
  Rotina...: <l> mc_00597 </l>
  --------------------------------------------------------------------------------------------------------------------------------
  Descriусo: <d> Atualiza o saldo Previsto mensal por natureza financeira - consolidado em SFC </d>
  --------------------------------------------------------------------------------------------------------------------------------
  Tipo.....: <t> Stored Procedure </t>
  --------------------------------------------------------------------------------------------------------------------------------
  Empresa..: MultCont Informрtica
  --------------------------------------------------------------------------------------------------------------------------------
  Autor....: Jurandy da Silva Costa
  --------------------------------------------------------------------------------------------------------------------------------
  Data.....: 15/01/2005 01:00:00
  --------------------------------------------------------------------------------------------------------------------------------
  Parametros
   [Entrada]ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии
   [Saida ]иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии
==================================================================================================================================*/
Create or Replace Function mc_00597####???
() Returns trigger
As $$
Begin
   -- Se Exclusсo ou Alteraусo subtrai do acumulado o valor anterior
   If tg_op <> 'INSERT' Then
      Perform mc_00586####???( old.f1_codnat,  old.fc5_data, (old.fc6_valor * -1), 0,
                               old.fa8_filial, 'FC6', old.fc5_tipo, 0 );
   End If;
   -- Se nсo for Exclusсo soma no acumulado o valor atual
   If tg_op <> 'DELETE' Then
      Perform mc_00586####???( new.f1_codnat,  new.fc5_data, new.fc6_valor, 0,
                               new.fa8_filial, 'FC6', new.fc5_tipo, 0 );
   End If;

   If tg_op <> 'DELETE' Then
      Return new;
   Else
      Return old;
   End If;
End;
$$ language plpgsql;

