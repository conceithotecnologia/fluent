/**
   Validação do responsável técnico

	@author    Ricardo Gonçalves
	@date      23/08/2012 13:36:00
	@trigger   A2Z B IUD

	Histórico
	---------------------------------------------------------------------------------------------------------------------
   Legenda: [-] - Correção / [*] - Recurso modificado/melhorado / [+] - Implementação de recurso
*/
CREATE OR REPLACE FUNCTION mc_00387####???()
  RETURNS trigger AS
$$
Declare
   r  record;
BEGIN
   if tg_op <> 'DELETE' then
      -- Validação do responsável técnico
      if new.a2z_status = 1 then
         perform ck_00006####???(new.a1_codcli, true);
      end if;

      select sa2_nome, sa2_email
        into r
        from [(sa2)]
       where a1_codcli = new.a1_codcli
         and sa2_ctrl = new.sa2_ctrl;

      -- Verifica o contato
      if r.sa2_email is null then
         raise '[[O contato técnico % deve possuir um e-mail válido em seu cadastro.]]', r.sa2_nome;
      end if;

      return new;
   else
      return old;
   end if;
END;
$$
  LANGUAGE 'plpgsql' VOLATILE;