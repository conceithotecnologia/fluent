/**
   Valida inserção da tarefa

	@author    Ricardo Gonçalves
	@date      02/11/2011 18:31:29
	@trigger   P02 B IUD

	Histórico
	---------------------------------------------------------------------------------------------------------------------
   Legenda: [-] - Correção / [*] - Recurso modificado/melhorado / [+] - Implementação de recurso
*/
CREATE OR REPLACE FUNCTION mc_00344####???()
  RETURNS trigger AS
$$
BEGIN
   if tg_op <> 'DELETE' then
      if tg_op = 'UPDATE' then
         -- Impede alteração de horas previstas
         if new.p02_hprev <> old.p02_hprev and new.p02_estado = old.p02_estado and new.p02_estado <> 1 then
            raise '[[A quantidade de horas previstas para tarefa "% - %" não pode ser modificada porque a tarefa está em andamento ou já foi finalizada.]]',
               new.recno, new.p02_descri;
         end if;
      end if;



      return new;
   else
      return old;
   end if;
END;
$$
  LANGUAGE 'plpgsql' VOLATILE;