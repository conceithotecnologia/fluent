/*==================================================================================================================================
  Rotina...: <l> sys_mark </l>
  --------------------------------------------------------------------------------------------------------------------------------
  Descriусo: <d> Rotina de Exemplo para processamento de selecoes de usuario </d>
  --------------------------------------------------------------------------------------------------------------------------------
  Tipo.....: <t> Stored Procedure </t>
  --------------------------------------------------------------------------------------------------------------------------------
  Empresa..: MultCont Informрtica
  --------------------------------------------------------------------------------------------------------------------------------
  Autor....: Wagner Mobile Costa
  --------------------------------------------------------------------------------------------------------------------------------
  Data.....: 03/09/2004 21:15:00
  --------------------------------------------------------------------------------------------------------------------------------
  Parametros
   [Entrada]ииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии
             in_userid: Id da sessсo ativa - IP / Empresa / Filial
             in_codform: Formulрrio Atual em execuусo
             in_codtable: Tabela atual 
   [Saida ]иииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииииии
==================================================================================================================================*/
Create or Replace Function sys_mark(varchar(25), varchar(30), varchar(20))
Returns integer
As '
Declare
   In_Userid     Alias For $1;
   In_codform    Alias For $2;
   In_codtable   Alias For $3;
   iReg Integer;
   iRecno Integer;
   curSS029 RefCursor;

Begin

-- Abro cursor de processamento selecionando sessсo atual, formulрrio e tabela selecionadas
-- pelo usuрrio

   Open curSS029 For
      Select Recno
        From ss029
       where userid = in_userid
         and codform = in_codform
         and codtable = in_codtable;

   Fetch curSS029 Into iRecno;

   iReg:= 0;

   While Found Loop
      iReg:= iReg + 1;

-- Aqui incluir o processamento da rotina de acordo com o formulрrio recebido como parametro

-- Apзs o processamento deleto a marcaусo efetuada pelo usuрrio
      
      delete
        from ss029
       where userid = in_userid
         and codform = in_codform
         and codtable = in_codtable
         and recno = iRecno;

      Fetch curSS029 Into iRecno;
   end loop;
   
   Close curSS029;

   Return iReg;
End;
' language 'plpgsql';
